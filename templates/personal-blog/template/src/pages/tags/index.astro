---
import { getCollection } from 'astro:content';
import Layout from '@/layouts/Layout.astro';
import TagCloud from '@/components/TagCloud.astro';
import { SITE } from '@/config';
import { getPublishedPosts, getAllTags, getPostsByTag } from '@/utils';

const allPosts = await getCollection('blog');
const publishedPosts = getPublishedPosts(allPosts);
const allTags = getAllTags(publishedPosts);

const tagsWithCounts = allTags.map(tag => ({
  name: tag,
  count: getPostsByTag(publishedPosts, tag).length
})).sort((a, b) => b.count - a.count);
---

<Layout 
  title={`Tags | ${SITE.title}`}
  description="Browse all tags and topics covered in the blog"
>
  <div class="container mx-auto px-4 py-8">
    <!-- Page Header -->
    <div class="text-center mb-12">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-4">
        Tags
      </h1>
      <p class="text-xl text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
        Explore posts by topic. Click on any tag to see related articles.
      </p>
    </div>

    {tagsWithCounts.length > 0 ? (
      <div class="space-y-8">
        <!-- Tag Cloud -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-8">
          <TagCloud tags={tagsWithCounts} />
        </div>

        <!-- Tag List -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-8">
          <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
            All Tags ({tagsWithCounts.length})
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {tagsWithCounts.map(tag => (
              <a
                href={`/tags/${tag.name}`}
                class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-primary-50 dark:hover:bg-primary-900/20 hover:border-primary-200 dark:hover:border-primary-800 border border-gray-200 dark:border-gray-600 transition-all duration-200 group"
              >
                <span class="font-medium text-gray-900 dark:text-white group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors">
                  {tag.name}
                </span>
                <span class="text-sm text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-600 px-2 py-1 rounded-full">
                  {tag.count}
                </span>
              </a>
            ))}
          </div>
        </div>
      </div>
    ) : (
      <div class="text-center py-12">
        <div class="text-6xl mb-4">üè∑Ô∏è</div>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
          No tags yet
        </h2>
        <p class="text-gray-600 dark:text-gray-400">
          Tags will appear here once you start publishing posts.
        </p>
      </div>
    )}
  </div>
</Layout>
