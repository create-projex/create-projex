---
import type { CollectionEntry } from 'astro:content';
import Layout from './Layout.astro';
import { formatDate, getReadingTime } from '@/utils';
import { SITE } from '@/config';

type Props = CollectionEntry<'blog'>['data'] & {
  slug: string;
  content: string;
};

const { title, description, pubDate, updatedDate, heroImage, heroImageAlt, tags, categories, slug, content } = Astro.props;

const articleJsonLd = {
  '@context': 'https://schema.org',
  '@type': 'BlogPosting',
  headline: title,
  description: description,
  image: heroImage ? new URL(heroImage, Astro.site) : undefined,
  datePublished: pubDate.toISOString(),
  dateModified: updatedDate ? updatedDate.toISOString() : pubDate.toISOString(),
  author: {
    '@type': 'Person',
    name: SITE.author.name,
    email: SITE.author.email,
  },
  publisher: {
    '@type': 'Organization',
    name: SITE.title,
  },
};
---

<Layout title={title} description={description} image={heroImage}>
  <script type="application/ld+json" set:html={JSON.stringify(articleJsonLd)} />
  
  <article class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Article Header -->
    <header class="mb-8">
      <!-- Hero Image -->
      {heroImage && (
        <div class="mb-8 aspect-video overflow-hidden rounded-lg">
          <img 
            src={heroImage} 
            alt={heroImageAlt || title}
            class="w-full h-full object-cover"
          />
        </div>
      )}

      <!-- Tags -->
      {tags.length > 0 && (
        <div class="flex flex-wrap gap-2 mb-4">
          {tags.map(tag => (
            <a 
              href={`/tags/${tag}`}
              class="inline-block px-3 py-1 text-sm font-medium text-primary-700 dark:text-primary-300 bg-primary-100 dark:bg-primary-900/30 rounded-full hover:bg-primary-200 dark:hover:bg-primary-900/50 transition-colors"
            >
              {tag}
            </a>
          ))}
        </div>
      )}

      <!-- Title -->
      <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 dark:text-white mb-4 leading-tight">
        {title}
      </h1>

      <!-- Description -->
      <p class="text-xl text-gray-600 dark:text-gray-400 mb-6 leading-relaxed">
        {description}
      </p>

      <!-- Meta Information -->
      <div class="flex flex-wrap items-center gap-4 text-sm text-gray-500 dark:text-gray-400 border-b border-gray-200 dark:border-gray-700 pb-6">
        <div class="flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a1 1 0 011-1h6a1 1 0 011 1v4h3a1 1 0 011 1v9a1 1 0 01-1 1H5a1 1 0 01-1-1V8a1 1 0 011-1h3z"></path>
          </svg>
          <time datetime={pubDate.toISOString()}>
            {formatDate(pubDate)}
          </time>
        </div>
        
        {updatedDate && (
          <div class="flex items-center">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
            <span>Updated {formatDate(updatedDate)}</span>
          </div>
        )}

        <div class="flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <span>{getReadingTime(content)}</span>
        </div>

        <div class="flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          <span>{SITE.author.name}</span>
        </div>
      </div>
    </header>

    <!-- Article Content -->
    <div class="prose prose-lg dark:prose-dark max-w-none">
      <slot />
    </div>

    <!-- Article Footer -->
    <footer class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700">
      <!-- Categories -->
      {categories.length > 0 && (
        <div class="mb-6">
          <h3 class="text-sm font-semibold text-gray-900 dark:text-white mb-2">Categories:</h3>
          <div class="flex flex-wrap gap-2">
            {categories.map(category => (
              <a 
                href={`/categories/${category}`}
                class="inline-block px-3 py-1 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
              >
                {category}
              </a>
            ))}
          </div>
        </div>
      )}

      <!-- Author Bio -->
      <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-6 mb-8">
        <div class="flex items-start space-x-4">
          <div class="flex-shrink-0">
            <div class="w-16 h-16 bg-primary-600 rounded-full flex items-center justify-center text-white text-xl font-bold">
              {SITE.author.name.charAt(0)}
            </div>
          </div>
          <div class="flex-1">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
              {SITE.author.name}
            </h3>
            <p class="text-gray-600 dark:text-gray-400 mb-3">
              {SITE.author.bio}
            </p>
            <div class="flex space-x-4">
              <a 
                href={`https://github.com/${SITE.author.social.github}`}
                target="_blank"
                rel="noopener noreferrer"
                class="text-gray-500 hover:text-primary-600 dark:hover:text-primary-400 transition-colors"
              >
                GitHub
              </a>
              <a 
                href={`https://twitter.com/${SITE.author.social.twitter}`}
                target="_blank"
                rel="noopener noreferrer"
                class="text-gray-500 hover:text-primary-600 dark:hover:text-primary-400 transition-colors"
              >
                Twitter
              </a>
              <a 
                href={`https://linkedin.com/in/${SITE.author.social.linkedin}`}
                target="_blank"
                rel="noopener noreferrer"
                class="text-gray-500 hover:text-primary-600 dark:hover:text-primary-400 transition-colors"
              >
                LinkedIn
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- #if comments -->
      <!-- Comments Section -->
      <div class="mb-8">
        <script src="https://giscus.app/client.js"
          data-repo="your-username/your-repo"
          data-repo-id="your-repo-id"
          data-category="General"
          data-category-id="your-category-id"
          data-mapping="pathname"
          data-strict="0"
          data-reactions-enabled="1"
          data-emit-metadata="0"
          data-input-position="bottom"
          data-theme="preferred_color_scheme"
          data-lang="en"
          crossorigin="anonymous"
          async>
        </script>
      </div>
      <!-- #endif -->

      <!-- Navigation -->
      <nav class="flex justify-between items-center">
        <a 
          href="/blog" 
          class="inline-flex items-center text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 font-medium transition-colors"
        >
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
          Back to Blog
        </a>
        
        <div class="flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400">
          <span>Share:</span>
          <a 
            href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(Astro.url.toString())}`}
            target="_blank"
            rel="noopener noreferrer"
            class="text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors"
          >
            Twitter
          </a>
          <a 
            href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(Astro.url.toString())}`}
            target="_blank"
            rel="noopener noreferrer"
            class="text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors"
          >
            LinkedIn
          </a>
        </div>
      </nav>
    </footer>
  </article>
</Layout>

